
var app_url = 'https://www.anphabe.com/aapi-lead/v1';

//https://developer.mozilla.org/en-US/docs/Learn/Forms/Form_validation
//https://getbootstrap.com/docs/5.0/forms/validation/  

function show_other(select_id, otherbox_id)
{
    // document.write('option changed!');
    var select_element=document.getElementById(select_id);
    var otherbox_element=document.getElementById(otherbox_id);
    if(select_element.value=="other")
    {
        otherbox_element.style.display='block';
    }
    else
    {
        otherbox_element.style.display='none';
    }
}

function keep_url_query(){
    let query = window.location.search;
    
    if(query == "") {
        return false;
    }
    let searchParams = new URLSearchParams(query);

    let atags = document.getElementsByTagName("a"); 
    let i;
    for (i = 0; i < atags.length; i++) {
        let new_url = new URL(atags[i].href);
        for (const [key, value] of searchParams) {
            new_url.searchParams.set(key, value);
        }
        atags[i].href = new_url.toString();  
    } 

    let elements = document.getElementById("destination"); 
    for (i = 0; i < elements.length; i++) {
        let new_url = new URL(elements[i].value);
        for (const [key, value] of searchParams) {
            new_url.searchParams.set(key, value);
        }
        elements[i].href = new_url.toString();  
    } 

}

if (
    document.readyState === "complete" ||
    (document.readyState !== "loading" && !document.documentElement.doScroll)
) {
  keep_url_query();
} else {
  document.addEventListener("DOMContentLoaded", keep_url_query);
}
var allow_contact_me = document.getElementById('allow_contact_me')
if(allow_contact_me){
    allow_contact_me.style.cssText = 'display:none !important'; 
}



jQuery(function ($) {

    /** Anphabe function */
    function updateUtmInput() {
        let query = window.location.search;  
        let searchParams = new URLSearchParams(query);
        if ( searchParams.has("utm_campaign")) {
            jQuery('[name ="utm_campaign"]').val(searchParams.get("utm_campaign"));
        }
        if ( searchParams.has("utm_source")) {
            jQuery('[name ="utm_source"]').val(searchParams.get("utm_source"));
        }
        if ( searchParams.has("utm_medium")) {
            jQuery('[name ="utm_medium"]').val(searchParams.get("utm_medium"));
        }
        if ( searchParams.has("utm_term")) {
            jQuery('[name ="utm_term"]').val(searchParams.get("utm_term"));
        }
        if ( searchParams.has("utm_content")) {
            jQuery('[name ="utm_content"]').val(searchParams.get("utm_content"));
        }
    }
    $(document).ready(function () {
       
        updateUtmInput();


        $(".mbr-form.anphabe-lead").submit(function (e) {
            if (!this.checkValidity()) {
                e.preventDefault();
                e.stopPropagation();
            }
            else{
                $('[type="submit"]').addClass('disabled');
                dataString = $(".form-register").serialize();
                var formData = new FormData(this);
            
                $.ajax({
                    type: "POST",
                    url: app_url,
                    data: formData,
                    processData: false,
                    contentType: false,
                    cache: false,
                    success: function (data) {
                        if (data.response) {
                            if(jQuery('#destination').length){
                                window.location.href = jQuery('#destination').prop('href');    
                            }
                            else{
                                window.location.href = "thankyou.html";
                            }
                        }
                        else {
                            window.location.href = "thankyou.html?err=1";
                        }
                    },
                    error: function (error) {
                    }
                });
            }
            jQuery(this).addClass('was-validated');

            return false;
        });

       

    }); // end function document ready
});
